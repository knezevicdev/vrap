version: '3'
services:
  product:
    build:
      args:
        CI_JOB_TOKEN: $CI_JOB_TOKEN
      context: ../../../
      dockerfile: ./apps/product/docker-local/Dockerfile
    user: 'root'
    environment:
      - CI_JOB_TOKEN=${CI_JOB_TOKEN}
      - BRANCH_IO_KEY=key_live_kcLYw3YkcZ81GfwRZ84cBcgmusnd6ysn
      - CDN_URL=
      - GEARBOX_PRIVATE_URL=https://gearbox-dev-int.vroomapi.com/query-private
      - INVSEARCH_V3_URL=https://invsearch-v3-dev-int.aws.vroomapi.com:8443/v3
      - INV_SERVICE_V2_URL=https://inventory-dev-int.vroomapi.com:8443/v2
      - SANTANDER_SEGMENT_WRITE_KEY=BP2otWcD2EbECrCfUwn1RuDQAPPYa6mv
      - SEGMENT_WRITE_KEY=N0pxERRIw4iYCoxZREMZj1yWBIoARIz4
      - STATIC_ASSETS_HOST_URL=https://static-assets.n.vroom.systems
      - TDA_SEGMENT_WRITE_KEY=TbYgIIsercszeyRUCwgE2F3mOWV9QMjb
      - VROOM_URL=https://uat.vroom.com
    command: ash -c "npm run dev -- --port 8080"
    # This starts nothing but leaves the container running, useful for
    # debugging nextjs start / config operations
    # command: ash -c "tail -f /dev/null"
    ports:
      - '8080:8080'
    volumes:
      # Setup a volume so source code edits will be reflected outside the container.
      - '../../../:/www/'
      # Setup volumes for dependencies and built artifacts.
      # This allows the node_modules created during the build to not be overwritten.
      # https://stackoverflow.com/questions/30043872/docker-compose-node-modules-not-present-in-a-volume-after-npm-install-succeeds
      # It also makes sure that the built artifacts are only present on the container,
      # and not copied back to the host machine.
      - '/www/node_modules'
      - '/www/apps/product/.next'
      - '/www/apps/product/node_modules'
