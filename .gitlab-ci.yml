image: node:latest

stages:
  - build

build-appraisal:
  only:
    refs:
      - merge_requests
    changes:
      - apps/appraisal/*
  stage: build
  script:
    - cd apps/appraisal
    - npm install --quiet
    - npm run lint
    - npm run build

lint-checkout:
  only:
    refs:
      - merge_requests
    changes:
      - apps/checkout/*
  stage: build
  script:
    - cd apps/checkout
    - npm install --quiet
    - npm run lint

build-checkout:
  only:
    refs:
      - merge_requests
    changes:
      - apps/checkout/*
  stage: build
  script:
    - cd apps/checkout
    - npm install --quiet
    - npm run build

build-home:
  only:
    refs:
      - merge_requests
    changes:
      - apps/home/*
  stage: build
  script:
    - cd apps/home
    - npm install --quiet
    - npm run lint
    - npm run build

build-landing:
  only:
    refs:
      - merge_requests
    changes:
      - apps/landing/*
  stage: build
  script:
    - cd apps/landing
    - npm install --quiet
    - npm run lint
    - npm run build

build-listing:
  only:
    refs:
      - merge_requests
    changes:
      - apps/listing/*
  stage: build
  script:
    - cd apps/listing
    - npm install --quiet
    - npm run lint
    - npm run build

test-listing:
  only:
    refs:
      - merge_requests
    changes:
      - apps/listing/*
  stage: build
  script:
    - cd apps/listing
    - npm install --quiet
    - npm run test:ci

build-marketing:
  only:
    refs:
      - merge_requests
    changes:
      - apps/marketing/*
  stage: build
  script:
    - cd apps/marketing
    - npm install --quiet
    - npm run lint
    - npm run build

build-product:
  only:
    refs:
      - merge_requests
    changes:
      - apps/product/*
  stage: build
  script:
    - cd apps/product
    - npm install --quiet
    - npm run lint
    - npm run build

test-product:
  only:
    refs:
      - merge_requests
    changes:
      - apps/product/*
  stage: build
  script:
    - cd apps/product
    - npm install --quiet
    - npm run test:ci
